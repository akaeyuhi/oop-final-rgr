(()=>{"use strict";var t,n=function(t){this.data=t},e=(t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)},function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});const r=function(t){function n(){return t.call(this,"")||this}return e(n,t),n.prototype.render=function(){return"<td></td>"},n}(n);var o=function(){function t(t){this.rawCells=t}return t.prototype.pushNullCell=function(){this.cells.push(new r)},Object.defineProperty(t.prototype,"textCells",{get:function(){return this.rawCells},enumerable:!1,configurable:!0}),t}(),i=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();const c=function(t){function n(n){return t.call(this,n)||this}return i(n,t),n.prototype.render=function(){return"<th>".concat(this.data,"</th>")},n}(n);var u=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();const l=function(t){function n(n){var e=t.call(this,n)||this;return e.cells=[],e.parseCells(),e}return u(n,t),n.prototype.parseCells=function(){this.cells=this.rawCells.map((function(t){return new c(t)})),"№"!==this.cells[0].data&&this.cells.unshift(new c("№"))},n.prototype.render=function(){return'<tr id="sort">'.concat(this.cells.map((function(t){return t.render()})).join("\n"),"</tr>")},n}(o);var s=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();const a=function(t){function n(n){return t.call(this,n)||this}return s(n,t),n.prototype.render=function(){return"<td>".concat(this.data,"</td>")},n}(n);var f=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();const p=function(t){function n(n){var e=t.call(this,n)||this;return e.cells=[],e.parseCells(),e}return f(n,t),n.prototype.parseCells=function(){this.cells=this.rawCells.map((function(t){return new a(t)}))},n.prototype.render=function(){return"<tr>".concat(this.cells.map((function(t){return t.render()})).join("\n"),"</tr>")},n}(o),h=new(function(){function t(){this.listeners=new Map}return t.prototype.subscribe=function(t,n){this.listeners.set(t,n)},t.prototype.unsubscribe=function(t){this.listeners.delete(t)},t.prototype.notify=function(t,n){this.listeners.forEach((function(e,r){e===t&&(r.notify(t,n),console.log(r))}))},t}());var y=function(){function t(t){var n,e=this;this.root=document.querySelector(".table-container"),this.rawText="",this.rows=[],this.mountSelector=t,null===(n=document.querySelector(".to-load"))||void 0===n||n.addEventListener("click",(function(){e.switch(),e.clearTable(),h.notify("closeTable",null)}))}return t.getInstance=function(n){return this.instance?this.instance:new t(n)},t.prototype.notify=function(t,n){this.rawText=n,this.generateRows(),this.setURL(),this.render(),this.setClick(),this.switch()},t.prototype.render=function(){var t,n=this;this.table=document.querySelector("".concat(this.mountSelector)),null===(t=this.rows)||void 0===t||t.forEach((function(t){var e;null===(e=n.table)||void 0===e||e.insertAdjacentHTML("beforeend",t.render())}))},t.prototype.parseData=function(){return this.rawText.split("\n").map((function(t){var n=new RegExp(/\t+/);return t.replace(n,"\t"),t.split("\t").filter((function(t){return""!==t&&"\t"!==t&&"\r"!==t}))})).filter((function(t){return t.length>0}))},t.prototype.setURL=function(){var t,n=this.rows.map((function(t){return t.textCells.join("\t")})).join("\n"),e=new Blob([n],{type:"text/plain"});null===(t=document.querySelector(".save"))||void 0===t||t.setAttribute("href",URL.createObjectURL(e))},t.prototype.generateRows=function(){var t,n=this,e=this.parseData(),r=new l(e[0]);null===(t=this.rows)||void 0===t||t.push(r),e.shift(),e.forEach((function(t){var e;null===(e=n.rows)||void 0===e||e.push(new p(t))})),this.normalizeRows()},t.prototype.normalizeRows=function(){var t,n=this;null===(t=this.rows)||void 0===t||t.forEach((function(t){for(;t.cells.length<n.rows[0].cells.length;)t.pushNullCell()}))},t.prototype.switch=function(){var t;null===(t=this.root)||void 0===t||t.classList.toggle("visible")},t.prototype.setClick=function(){var t,n=this;null===(t=document.querySelector("#sort"))||void 0===t||t.addEventListener("click",(function(t){var e;"TH"===t.target.tagName&&n.sortTable(Array.prototype.indexOf.call(null===(e=t.target.parentNode)||void 0===e?void 0:e.children,t.target))}))},t.prototype.clearTable=function(){this.table.innerHTML="",this.rawText="",this.rows=[]},t.prototype.sortTable=function(t){var n,e,r,o,i,c,u,l,s=!1,a=0;o=!0,l="asc";for(var f=function(t,n){var e=c.innerHTML.toLowerCase(),r=u.innerHTML.toLowerCase();if(0===t&&(e=+e,r=+r),"asc"===n){if(e>r)return!0}else if("desc"===n&&e<r)return!0};o;){for(o=!1,r=null===(n=this.table)||void 0===n?void 0:n.rows,i=1;i<r.length-1;i++){s=!1,c=r[i].getElementsByTagName("TD")[t],u=r[i+1].getElementsByTagName("TD")[t];var p=f(t,l);if(p){s=p;break}}s?(null===(e=r[i].parentNode)||void 0===e||e.insertBefore(r[i+1],r[i]),o=!0,a++):0==a&&"asc"==l&&(l="desc",o=!0)}},t.instance=null,t}(),d=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function c(t){try{l(r.next(t))}catch(t){i(t)}}function u(t){try{l(r.throw(t))}catch(t){i(t)}}function l(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(c,u)}l((r=r.apply(t,n||[])).next())}))},v=function(t,n){var e,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;c;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=n.call(t,c)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},w=function(){function t(){this.element=document.querySelector(".reader"),this.root=document.querySelector(".reader-container"),this.reader=new FileReader,this.render()}return t.getInstance=function(){return this.instance?this.instance:new t},t.prototype.submitHandler=function(t){return d(this,void 0,void 0,(function(){var n,e,r;return v(this,(function(o){switch(o.label){case 0:return null==t||t.preventDefault(),n=null==t?void 0:t.target,e=n.children[1],this.reader.readAsText(e.files[0],"utf-8"),[4,this.getRawText()];case 1:return r=o.sent(),h.notify("loadText",r),this.switch(),[2]}}))}))},t.prototype.getRawText=function(){var t=this;return new Promise((function(n){t.reader.onload=function(t){var e;n(null===(e=t.target)||void 0===e?void 0:e.result)}}))},t.prototype.switch=function(){var t;null===(t=this.root)||void 0===t||t.classList.toggle("visible-flex")},t.prototype.notify=function(t){"closeTable"===t&&this.switch()},t.prototype.render=function(){var t,n,e=this;this.element.innerHTML="",null===(t=this.element)||void 0===t||t.insertAdjacentHTML("beforeend",'<form class="fileInput">\n                      <label for="file">Завантажте файл</label>\n                      <input type="file" name="file" id="file" accept=".txt" required>\n                      <input type="submit" value="Завантажити таблицю">\n            </form>'),null===(n=document.querySelector(".fileInput"))||void 0===n||n.addEventListener("submit",(function(){return d(e,void 0,void 0,(function(){return v(this,(function(t){switch(t.label){case 0:return[4,this.submitHandler(event)];case 1:return[2,t.sent()]}}))}))}))},t.instance=null,t}();document.addEventListener("DOMContentLoaded",(function(){return t=void 0,n=void 0,r=function(){var t,n;return function(t,n){var e,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;c;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((o=(o=c.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=n.call(t,c)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}(this,(function(e){return t=w.getInstance(),n=y.getInstance("#app"),h.subscribe(t,"closeTable"),h.subscribe(n,"loadText"),[2]}))},new((e=void 0)||(e=Promise))((function(o,i){function c(t){try{l(r.next(t))}catch(t){i(t)}}function u(t){try{l(r.throw(t))}catch(t){i(t)}}function l(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(c,u)}l((r=r.apply(t,n||[])).next())}));var t,n,e,r}))})();